---
- name: Setup tmux
  block:
    - name: TMUX | Check for tmux
      ansible.builtin.shell: command -v tmux
      register: tmux_exists
      ignore_errors: true
      changed_when: false

    - name: TMUX | Install via APT
      ansible.builtin.apt:
        name: tmux
        state: present
        update_cache: yes
      when: tmux_exists is failed

    - name: TMUX | Install TPM
      ansible.builtin.git:
        repo: https://github.com/tmux-plugins/tpm
        dest: "{{ ansible_user_dir }}/.tmux/plugins/tpm"
        depth: 1

    - name: TMUX | Copy tmux.conf
      ansible.builtin.copy:
        src: tmux.conf
        dest: "{{ ansible_user_dir }}/.tmux.conf"
        mode: u=rwx,g=rx,o=rx

    - name: TMUX | Source tmux config
      ansible.builtin.shell: tmux source ~/.tmux.conf
      ignore_errors: true
      changed_when: false
